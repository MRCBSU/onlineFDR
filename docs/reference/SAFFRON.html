<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SAFFRON: Adaptive online FDR control — SAFFRON • onlineFDR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="SAFFRON: Adaptive online FDR control — SAFFRON" />
<meta property="og:description" content="Implements the SAFFRON procedure for online FDR control, where SAFFRON stands
for Serial estimate of the Alpha Fraction that is Futiley Rationed On true
Null hypotheses, as presented by Ramdas et al. (2018). The algorithm is based
on an estimate of the proportion of true null hypotheses. More precisely,
SAFFRON sets the adjusted test levels based on an estimate of the amount of
alpha-wealth that is allocated to testing the true null hypotheses." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">onlineFDR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/onlineFDR-vignette.html">Managing multiple testing challenges with sequential inference using the onlineFDR package</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SAFFRON: Adaptive online FDR control</h1>
    
    <div class="hidden name"><code>SAFFRON.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements the SAFFRON procedure for online FDR control, where SAFFRON stands
for Serial estimate of the Alpha Fraction that is Futiley Rationed On true
Null hypotheses, as presented by Ramdas et al. (2018). The algorithm is based
on an estimate of the proportion of true null hypotheses. More precisely,
SAFFRON sets the adjusted test levels based on an estimate of the amount of
alpha-wealth that is allocated to testing the true null hypotheses.</p>
    </div>

    <pre class="usage"><span class='fu'>SAFFRON</span>(<span class='no'>d</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>, <span class='no'>gammai</span>, <span class='no'>w0</span>, <span class='kw'>lambda</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>random</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>date.format</span> <span class='kw'>=</span> <span class='st'>"%Y-%m-%d"</span>, <span class='kw'>discard</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>tau.discard</span> <span class='kw'>=</span> <span class='fl'>0.5</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>Either a vector of p-values, or a dataframe with three columns: an
identifier (`id'), date (`date') and p-value (`pval'). If no column of
dates is provided, then the p-values are treated as being ordered
sequentially with no batches.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Overall significance level of the FDR procedure, the default is
0.05.</p></td>
    </tr>
    <tr>
      <th>gammai</th>
      <td><p>Optional vector of \(\gamma_i\). A default is provided with
\(\gamma_j\) proportional to \(1/j^(1.6)\).</p></td>
    </tr>
    <tr>
      <th>w0</th>
      <td><p>Initial `wealth' of the procedure, defaults to \(\alpha/2\). Must
be between 0 and \(\alpha\).</p></td>
    </tr>
    <tr>
      <th>lambda</th>
      <td><p>Optional threshold for a `candidate' hypothesis, must be
between 0 and 1. Defaults to 0.5.</p></td>
    </tr>
    <tr>
      <th>random</th>
      <td><p>Logical. If <code>TRUE</code> (the default), then the order of the
p-values in each batch (i.e. those that have exactly the same date) is
randomised.</p></td>
    </tr>
    <tr>
      <th>date.format</th>
      <td><p>Optional string giving the format that is used for dates.</p></td>
    </tr>
    <tr>
      <th>discard</th>
      <td><p>Logical. If <code>TRUE</code> then runs the ADDIS algorithm with
adaptive discarding of conservative nulls. The default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>tau.discard</th>
      <td><p>Optional threshold for hypotheses to be selected for
testing. Must be between 0 and 1, defaults to 0.5. This is required if
<code>discard=TRUE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    

<dt>d.out</dt><dd><p>A dataframe with the original data <code>d</code> (which
  will be reordered if there are batches and <code>random = TRUE</code>), the
  LORD-adjusted significance thresholds \(\alpha_i\) and the indicator
  function of discoveries <code>R</code>. Hypothesis \(i\) is rejected if the
  \(i\)-th p-value is less than or equal to \(\alpha_i\), in which case
  <code>R[i] = 1</code>  (otherwise <code>R[i] = 0</code>).</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function takes as its input either a vector of p-values or a dataframe
with three columns: an identifier (`id'), date (`date') and p-value (`pval').
The case where p-values arrive in batches corresponds to multiple instances
of the same date. If no column of dates is provided, then the p-values are
treated as being ordered sequentially with no batches.</p>
<p>SAFFRON procedure provably controls FDR for independent p-values. Given an
overall significance level \(\alpha\), we choose a sequence of non-negative
non-increasing numbers \(\gamma_i\) that sum to 1.</p>
<p>SAFFRON depends on constants \(w_0\) and \(\lambda\), where \(w_0\)
satisfies \(0 \le w_0 \le \alpha\) and represents the intial `wealth' of
the procedure, and \(0 &lt; \lambda &lt; 1\) represents the threshold for a
`candidate' hypothesis. A `candidate' refers to p-values smaller than
\(\lambda\), since SAFFRON will never reject a p-value larger than
\(\lambda\).</p>
<p>Note that FDR control also holds for the SAFFRON procedure if only the
p-values corresponding to true nulls are mutually independent, and
independent from the non-null p-values.</p>
<p>The SAFFRON procedure can lose power in the presence of conservative nulls,
which can be compensated for by adaptively `discarding' these p-values. This
option is called by setting <code>discard=TRUE</code>, which is the same algorithm
as ADDIS.</p>
<p>Further details of the SAFFRON procedure can be found in Ramdas et al.
(2018).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ramdas, A., Zrnic, T., Wainwright M.J. and Jordan, M.I. (2018).
  SAFFRON: an adaptive algorithm for online control of the false discovery
  rate. <em>Proceedings of the 35th International Conference in Machine
  Learning</em>, 80:4286-4294.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='SAFFRONstar.html'>SAFFRONstar</a></code> presents versions of SAFFRON for
<em>asynchronous</em> testing, i.e. where each hypothesis test can itself be a
sequential process and the tests can overlap in time.</p>
<p>If option <code>discard=TRUE</code>, SAFFRON is the same as <code><a href='ADDIS.html'>ADDIS</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>sample.df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(
<span class='kw'>id</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'A15432'</span>, <span class='st'>'B90969'</span>, <span class='st'>'C18705'</span>, <span class='st'>'B49731'</span>, <span class='st'>'E99902'</span>,
    <span class='st'>'C38292'</span>, <span class='st'>'A30619'</span>, <span class='st'>'D46627'</span>, <span class='st'>'E29198'</span>, <span class='st'>'A41418'</span>,
    <span class='st'>'D51456'</span>, <span class='st'>'C88669'</span>, <span class='st'>'E03673'</span>, <span class='st'>'A63155'</span>, <span class='st'>'B66033'</span>),
<span class='kw'>date</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"2014-12-01"</span>,<span class='fl'>3</span>),
               <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"2015-09-21"</span>,<span class='fl'>5</span>),
                <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"2016-05-19"</span>,<span class='fl'>2</span>),
                <span class='st'>"2016-11-12"</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"2017-03-27"</span>,<span class='fl'>4</span>))),
<span class='kw'>pval</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2.90e-08</span>, <span class='fl'>0.06743</span>, <span class='fl'>0.01514</span>, <span class='fl'>0.08174</span>, <span class='fl'>0.00171</span>,
        <span class='fl'>3.60e-05</span>, <span class='fl'>0.79149</span>, <span class='fl'>0.27201</span>, <span class='fl'>0.28295</span>, <span class='fl'>7.59e-08</span>,
        <span class='fl'>0.69274</span>, <span class='fl'>0.30443</span>, <span class='fl'>0.00136</span>, <span class='fl'>0.72342</span>, <span class='fl'>0.54757</span>))

<span class='fu'>SAFFRON</span>(<span class='no'>sample.df</span>, <span class='kw'>random</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt;        id       date       pval      alphai R
#&gt; 1  A15432 2014-12-01 2.9000e-08 0.005468627 1
#&gt; 2  B90969 2014-12-01 6.7430e-02 0.010937254 0
#&gt; 3  C18705 2014-12-01 1.5140e-02 0.010937254 0
#&gt; 4  B49731 2015-09-21 8.1740e-02 0.010937254 0
#&gt; 5  E99902 2015-09-21 1.7100e-03 0.010937254 1
#&gt; 6  C38292 2015-09-21 3.6000e-05 0.021874508 1
#&gt; 7  A30619 2015-09-21 7.9149e-01 0.032811762 0
#&gt; 8  D46627 2015-09-21 2.7201e-01 0.010823845 0
#&gt; 9  E29198 2016-05-19 2.8295e-01 0.010823845 0
#&gt; 10 A41418 2016-05-19 7.5900e-08 0.010823845 1
#&gt; 11 D51456 2016-11-12 6.9274e-01 0.021761099 0
#&gt; 12 C88669 2017-03-27 3.0443e-01 0.009265591 0
#&gt; 13 E03673 2017-03-27 1.3600e-03 0.009265591 1
#&gt; 14 A63155 2017-03-27 7.2342e-01 0.020202846 0
#&gt; 15 B66033 2017-03-27 5.4757e-01 0.009064367 0</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>1</span>); <span class='fu'>SAFFRON</span>(<span class='no'>sample.df</span>)</div><div class='output co'>#&gt;        id       date       pval      alphai R
#&gt; 1  A15432 2014-12-01 2.9000e-08 0.005468627 1
#&gt; 2  B90969 2014-12-01 6.7430e-02 0.010937254 0
#&gt; 3  C18705 2014-12-01 1.5140e-02 0.010937254 0
#&gt; 4  B49731 2015-09-21 8.1740e-02 0.010937254 0
#&gt; 5  E99902 2015-09-21 1.7100e-03 0.010937254 1
#&gt; 6  D46627 2015-09-21 2.7201e-01 0.021874508 0
#&gt; 7  C38292 2015-09-21 3.6000e-05 0.021874508 1
#&gt; 8  A30619 2015-09-21 7.9149e-01 0.032811762 0
#&gt; 9  A41418 2016-05-19 7.5900e-08 0.010823845 1
#&gt; 10 E29198 2016-05-19 2.8295e-01 0.021761099 0
#&gt; 11 D51456 2016-11-12 6.9274e-01 0.021761099 0
#&gt; 12 A63155 2017-03-27 7.2342e-01 0.009265591 0
#&gt; 13 C88669 2017-03-27 3.0443e-01 0.005456418 0
#&gt; 14 B66033 2017-03-27 5.4757e-01 0.005456418 0
#&gt; 15 E03673 2017-03-27 1.3600e-03 0.003688669 1</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>1</span>); <span class='fu'>SAFFRON</span>(<span class='no'>sample.df</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>0.1</span>, <span class='kw'>w0</span><span class='kw'>=</span><span class='fl'>0.025</span>)</div><div class='output co'>#&gt;        id       date       pval      alphai R
#&gt; 1  A15432 2014-12-01 2.9000e-08 0.005468627 1
#&gt; 2  B90969 2014-12-01 6.7430e-02 0.021874508 0
#&gt; 3  C18705 2014-12-01 1.5140e-02 0.021874508 1
#&gt; 4  B49731 2015-09-21 8.1740e-02 0.043749017 0
#&gt; 5  E99902 2015-09-21 1.7100e-03 0.043749017 1
#&gt; 6  D46627 2015-09-21 2.7201e-01 0.065623525 0
#&gt; 7  C38292 2015-09-21 3.6000e-05 0.065623525 1
#&gt; 8  A30619 2015-09-21 7.9149e-01 0.087498033 0
#&gt; 9  A41418 2016-05-19 7.5900e-08 0.028863587 1
#&gt; 10 E29198 2016-05-19 2.8295e-01 0.050738095 0
#&gt; 11 D51456 2016-11-12 6.9274e-01 0.050738095 0
#&gt; 12 A63155 2017-03-27 7.2342e-01 0.022302945 0
#&gt; 13 C88669 2017-03-27 3.0443e-01 0.013293195 0
#&gt; 14 B66033 2017-03-27 5.4757e-01 0.013293195 0
#&gt; 15 E03673 2017-03-27 1.3600e-03 0.009042997 1</div><div class='input'>
<span class='fu'>SAFFRON</span>(<span class='no'>sample.df</span>, <span class='kw'>discard</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>random</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt;          pval      alphai R
#&gt; 1  2.9000e-08 0.002734314 1
#&gt; 2  6.7430e-02 0.005468627 0
#&gt; 3  1.5140e-02 0.005468627 0
#&gt; 4  8.1740e-02 0.005468627 0
#&gt; 5  1.7100e-03 0.005468627 1
#&gt; 6  3.6000e-05 0.010937254 1
#&gt; 7  7.9149e-01 0.016405881 0
#&gt; 8  2.7201e-01 0.016405881 0
#&gt; 9  2.8295e-01 0.005411923 0
#&gt; 10 7.5900e-08 0.002828822 1
#&gt; 11 6.9274e-01 0.008297449 0
#&gt; 12 3.0443e-01 0.008297449 0
#&gt; 13 1.3600e-03 0.003589243 1
#&gt; 14 7.2342e-01 0.009057870 0
#&gt; 15 5.4757e-01 0.009057870 0</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David S. Robertson, Aaditya Ramdas, Adel Javanmard, Andrea Montanari, Jinjin Tian, Tijana Zrnic, Natasha A. Karp.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '4c638d00ee22961d7aab55c43dd0309d',
    indexName: 'onlinefdr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


